<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="microrobot">
  <!-- Geometric Properties -->
  <xacro:property name="platform_diameter" value="0.0365"/>
  <xacro:property name="platform_thickness" value="0.001"/>
  <xacro:property name="triangle_side" value="0.0292"/>
  <xacro:property name="support_diameter" value="0.002"/>
  <xacro:property name="motor_depth" value="0.008"/>
  <xacro:property name="eccentric_load_length" value="0.0044"/>
  <xacro:property name="distance_between_motors" value="0.0117"/> 

  <!-- Physical Properties -->
  <xacro:property name="platform_mass" value="10"/>
  <xacro:property name="support_mass" value="2"/>
  <xacro:property name="motor_mass" value="2"/>
  <xacro:property name="eccenter_mass" value="5"/>

  <material name="white">
    <color rgba="1 1 1 1"/>
  </material>

  <material name="gold">
    <color rgba="1 0.95 0 1"/>
  </material>

  <link name="platform_link">
    <visual>
      <geometry>
        <cylinder length="${platform_thickness}" radius="${platform_diameter/2}"/>
      </geometry>
      <material name="white"/>
    </visual>
    <collision>
      <geometry>
        <cylinder length="${platform_thickness}" radius="${platform_diameter/2}"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="${platform_mass}"/>
      <inertia ixx="${1/12*platform_mass*(3*(platform_diameter/2)**2 + platform_thickness**2)}" 
               ixy="0.0" ixz="0.0" 
               iyy="${1/12*platform_mass*(3*(platform_diameter/2)**2 + platform_thickness**2)}"  
               iyz="0.0" 
               izz="${1/12*platform_mass*(platform_diameter/2)**2}" />
    </inertial>
  </link>

  <link name="support_A">
    <visual>
      <geometry>
        <sphere radius="${support_diameter}"/>
      </geometry>
      <material name="white"/>
      <origin xyz=" ${triangle_side/2 - support_diameter/2} 
                    ${-sin(radians(30)) * (platform_diameter/2 - support_diameter/2)}
                    0"/>
    </visual>
    <collision>
      <geometry>
        <sphere radius="${support_diameter}"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="${support_mass}"/>
      <inertia ixx="${2/5*support_mass*(support_diameter/2)**2}" 
               ixy="0.0" ixz="0.0" 
               iyy="${2/5*support_mass*(support_diameter/2)**2}"  
               iyz="0.0" 
               izz="${2/5*support_mass*(support_diameter/2)**2}" />
    </inertial>
  </link>

  <joint name="platform_to_support_A" type="fixed">
    <parent link="platform_link"/>
    <child link="support_A"/>
  </joint>

  <link name="support_B">
    <visual>
      <geometry>
        <sphere radius="${support_diameter}"/>
      </geometry>
      <material name="white"/>
      <origin xyz="0 ${platform_diameter/2 - support_diameter} 0"/>
    </visual>
    <collision>
      <geometry>
        <sphere radius="${support_diameter}"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="${support_mass}"/>
      <inertia ixx="${2/5*support_mass*(support_diameter/2)**2}" 
               ixy="0.0" ixz="0.0" 
               iyy="${2/5*support_mass*(support_diameter/2)**2}"  
               iyz="0.0" 
               izz="${2/5*support_mass*(support_diameter/2)**2}" />
    </inertial>
  </link>

  <joint name="platform_to_support_B" type="fixed">
    <parent link="platform_link"/>
    <child link="support_B"/>
  </joint>

  <link name="support_C">
    <visual>
      <geometry>
        <sphere radius="${support_diameter}"/>
      </geometry>
      <material name="white"/>
      <origin xyz=" ${-triangle_side/2 + support_diameter/2} 
                    ${-sin(radians(30)) * (platform_diameter/2 - support_diameter/2)}
                    0"/>
    </visual>
    <collision>
      <geometry>
        <sphere radius="${support_diameter}"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="${support_mass}"/>
      <inertia ixx="${2/5*support_mass*(support_diameter/2)**2}" 
               ixy="0.0" ixz="0.0" 
               iyy="${2/5*support_mass*(support_diameter/2)**2}"  
               iyz="0.0" 
               izz="${2/5*support_mass*(support_diameter/2)**2}" />
    </inertial>
  </link>

  <joint name="platform_to_support_C" type="fixed">
    <parent link="platform_link"/>
    <child link="support_C"/>
  </joint>

  <link name="left_motor">
    <visual>
      <geometry>
        <box size="${motor_depth} ${motor_depth/2} ${motor_depth/2}"/>
      </geometry>
      <material name="white"/>
      <origin xyz=" ${-(distance_between_motors/2 + motor_depth/2 + eccentric_load_length)} 
                    0 
                    ${motor_depth/4 + platform_thickness/2}"/>
    </visual>
    <collision>
      <geometry>
        <box size="${motor_depth} ${motor_depth/2} ${motor_depth/2}"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="${motor_mass}"/>
      <inertia ixx="${1/12*motor_mass*(motor_depth**2 + (motor_depth/2)**2)}" 
               ixy="0.0" ixz="0.0" 
               iyy="${1/12*motor_mass*(motor_depth**2 + (motor_depth/2)**2)}"  
               iyz="0.0" 
               izz="${1/12*motor_mass*(motor_depth**2 + (motor_depth/2)**2)}" />
    </inertial>
  </link>

  <joint name="platform_to_left_motor" type="fixed">
    <parent link="platform_link"/>
    <child link="left_motor"/>
  </joint>

  <link name="left_eccenter">
    <visual>
      <geometry>
        <mesh filename="package://microrobot/meshes/test.stl"
              scale= "0.05 0.05 0.05"/>
      </geometry>
      <material name="gold"/>
      <origin rpy= "0 0 0" 
              xyz=" 0  
                    0
                    0"/>
    </visual>
    <collision>
      <geometry>
         <mesh filename="package://microrobot/meshes/test.stl"
              scale= "0.05 0.05 0.05"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="10"/>
      <inertia ixx="0.4" ixy="0.0" ixz="0.0" iyy="0.4" iyz="0.0" izz="0.2"/>
    </inertial>
  </link>

  <joint name="left_motor_to_eccenter" type="continuous">
    <parent link="left_motor"/>
    <child link="left_eccenter"/>
    <axis xyz="1 0 0"/>
    <origin xyz=" ${-distance_between_motors/2}  
                  0
                  ${motor_depth/4 + platform_thickness/2}"/>
  </joint>

  <link name="right_motor">
    <visual>
      <geometry>
        <box size="${motor_depth} ${motor_depth/2} ${motor_depth/2}"/>
      </geometry>
      <material name="white"/>
      <origin xyz=" ${distance_between_motors/2 + motor_depth/2 + eccentric_load_length} 
                    0 
                    ${motor_depth/4 + platform_thickness/2}"/>
    </visual>
    <collision>
      <geometry>
         <box size="${motor_depth} ${motor_depth/2} ${motor_depth/2}"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="${motor_mass}"/>
      <inertia ixx="${1/12*motor_mass*(motor_depth**2 + (motor_depth/2)**2)}" 
               ixy="0.0" ixz="0.0" 
               iyy="${1/12*motor_mass*(motor_depth**2 + (motor_depth/2)**2)}"  
               iyz="0.0" 
               izz="${1/12*motor_mass*(motor_depth**2 + (motor_depth/2)**2)}" />
    </inertial>
  </link>

  <joint name="platform_to_right_motor" type="fixed">
    <parent link="platform_link"/>
    <child link="right_motor"/>
  </joint>

   <link name="right_eccenter">
    <visual>
      <geometry>
        <mesh filename="package://microrobot/meshes/test.stl"
              scale= "0.05 0.05 0.05"/>
      </geometry>
      <material name="gold"/>
      <origin rpy= "0 0 ${radians(180)}" 
              xyz=" 0  
                    0
                    0"/>
    </visual>
    <collision>
      <geometry>
         <mesh filename="package://microrobot/meshes/test.stl"
              scale= "0.05 0.05 0.05"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="10"/>
      <inertia ixx="0.4" ixy="0.0" ixz="0.0" iyy="0.4" iyz="0.0" izz="0.2"/>
    </inertial>
  </link>

  <joint name="right_motor_to_eccenter" type="continuous">
    <parent link="left_motor"/>
    <child link="right_eccenter"/>
    <axis xyz="1 0 0"/>
    <origin xyz=" ${distance_between_motors/2}  
                  0
                  ${motor_depth/4 + platform_thickness/2}"/>
  </joint>
</robot>